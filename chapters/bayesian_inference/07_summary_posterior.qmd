# Sintesi a posteriori {#sec-bayesian-inference-summary-posterior}

::: {.epigraph}
> ‚ÄúThe summary of a posterior distribution is an essential step for its interpretation. Point estimators and credible intervals are the most common Bayesian answers, but they should not make us forget the richness of the entire posterior.‚Äù
>
> -- **Christian P. Robert**, The Bayesian Choice (2007)
:::

## Introduzione {.unnumbered .unlisted}

Nei capitoli precedenti abbiamo imparato a costruire distribuzioni a posteriori combinando la nostra conoscenza preliminare (*prior*) con i dati osservati attraverso la verosimiglianza. Abbiamo visto come questo processo si realizzi in casi semplici, come la stima di una proporzione di successi con il modello Beta‚ÄìBinomiale, e come possa essere generalizzato grazie al concetto di famiglie coniugate. Ora ci poniamo una domanda fondamentale: una volta che abbiamo ottenuto una distribuzione a posteriori, *come possiamo riassumerla e comunicarla in modo chiaro ed efficace?*

Il *posterior* non √® un singolo numero, ma un‚Äôintera distribuzione che rappresenta la nostra incertezza sul parametro. Nella pratica della ricerca psicologica, tuttavia, dobbiamo spesso sintetizzare queste informazioni per presentarle nei risultati di un articolo o per confrontarle con altre stime. Questo capitolo √® dedicato proprio a questa esigenza: mostreremo come ricavare quantit√† riassuntive (media, mediana, moda) e come costruire intervalli credibili che esprimano in modo trasparente i valori pi√π plausibili.

L‚Äôobiettivo non √® ridurre l‚Äôinferenza bayesiana alla ricerca di un punto o di un intervallo, ma imparare a *comunicare l‚Äôincertezza* in modo comprensibile, senza perdere la ricchezza informativa del posterior. Come vedremo, anche nei contesti pi√π complessi, la capacit√† di sintetizzare correttamente le distribuzioni a posteriori √® ci√≤ che distingue un‚Äôanalisi meramente tecnica da una presentazione scientifica chiara e convincente.


### Panoramica del capitolo {.unnumbered .unlisted}

- Distribuzione a posteriori = conoscenza aggiornata.
- Stime puntuali: MAP, media, mediana.
- Incertezza: varianza e deviazione standard.
- Intervalli di credibilit√†: simmetrici e HPD.
- Verifica di ipotesi: probabilit√† a posteriori.


::: {.callout-tip collapse=true}
## Prerequisiti

- Leggere il capitolo *Posterior Inference & Prediction* del testo di  @Johnson2022bayesrules.
:::

::: {.callout-caution collapse=true title="Preparazione del Notebook"}

```{r}
here::here("code", "_common.R") |> 
  source()

# Load packages
if (!requireNamespace("pacman")) install.packages("pacman")
pacman::p_load(mice)
```
:::


## Riepilogo numerico

La distribuzione a posteriori contiene in s√© tutte le informazioni disponibili sui potenziali valori del parametro. Nel caso di un parametro unidimensionale o bidimensionale, possiamo rappresentare la distribuzione a posteriori mediante un grafico $p(\theta \mid y)$. Tuttavia, quando ci troviamo di fronte a vettori di parametri con pi√π di due dimensioni, risulta vantaggioso eseguire una sintesi numerica della distribuzione a posteriori. Possiamo distinguere due forme di sintesi numerica della distribuzione a posteriori: stima puntuale e intervallo di credibilit√†.


## Stima puntuale  

Nel contesto dell‚Äô*inferenza bayesiana*, stimare il valore pi√π credibile di un parametro $\theta$ a partire dalla distribuzione a posteriori pu√≤ avvenire attraverso tre statistiche principali: *moda, mediana e media*. La scelta tra queste dipende dalla forma della distribuzione a posteriori.  Queste statistiche forniscono una *stima puntuale* della tendenza centrale della distribuzione, ossia il valore a cui attribuiamo il massimo grado di fiducia soggettiva, basandoci sia sui dati osservati sia sulle credenze a priori.  

### Moda (*Massimo a Posteriori*, MAP) {.unnumbered}

La moda della distribuzione a posteriori, nota come stima di *massimo a posteriori (MAP)*, corrisponde al valore del parametro $\theta$ a cui √® associata la massima densit√† di probabilit√†. Questo concetto rappresenta l‚Äôestensione bayesiana della classica *stima di massima verosimiglianza (MLE)*, definita come:

$$
\hat{\theta}_{\text{ML}} = \arg \max_\theta L(\theta \mid y),
$$
dove $L(\theta \mid y)$ √® la funzione di verosimiglianza. Nell‚Äôapproccio bayesiano, l‚Äôinformazione a priori $p(\theta)$ viene incorporata attraverso il teorema di Bayes, portando alla definizione della stima MAP:

$$
\hat{\theta}_{\text{MAP}} = \arg \max_\theta \, L(\theta \mid y) \, p(\theta).
$$
In altre parole, $\hat{\theta}_{\text{MAP}}$ massimizza la densit√† a posteriori non normalizzata, combinando in modo esplicito l‚Äôevidenza empirica con la conoscenza pregressa.


#### Limitazioni della stima MAP

Nonostante l‚Äôinterpretazione intuitiva, la stima MAP presenta alcune limitazioni di cui √® importante essere consapevoli. In primo luogo, la sua determinazione pu√≤ risultare computazionalmente impegnativa, specialmente quando la distribuzione a posteriori viene campionata mediante metodi MCMC: individuare con precisione il massimo in uno spazio di parametri ad alta dimensionalit√† o con forme complesse richiede tecniche specifiche e pu√≤ essere instabile.

In secondo luogo, la bont√† della stima MAP dipende fortemente dalla forma della distribuzione a posteriori. In presenza di asimmetrie marcate o di multimodalit√†, il massimo globale potrebbe non essere rappresentativo della regione di alta probabilit√†, soprattutto se associato a un picco stretto ma isolato, mentre la maggior parte della massa probabilistica si trova altrove.

Infine, il MAP √® intrinsecamente meno robusto di altre statistiche centrali, come la media o la mediana a posteriori, in quanto basato esclusivamente sul valore di massimo densit√†, ignorando la forma complessiva della distribuzione. Ci√≤ lo rende sensibile a variazioni nella parametrizzazione del modello e poco informativo riguardo all‚Äôincertezza complessiva sul parametro.


### Media a posteriori {.unnumbered}

La *media a posteriori* rappresenta il valore atteso del parametro $\theta$ rispetto alla sua distribuzione a posteriori. Formalmente, essa √® definita come:

$$
\mathbb{E}[\theta \mid y] = \int \theta \, p(\theta \mid y) \, d\theta.
$$
Questa quantit√† costituisce una stima di $\theta$ che tiene conto dell'intera distribuzione a posteriori, integrando su tutti i possibili valori del parametro. Una propriet√† notevole della media a posteriori √® quella di essere lo stimatore che minimizza l‚Äô*errore quadratico medio (MSE)* nella previsione di $\theta$, il che ne giustifica l‚Äôampio utilizzo in contesti di ottimizzazione statistica.

Tuttavia, in presenza di distribuzioni a posteriori marcatamente *asimmetriche* o con *code pesanti*, la media potrebbe non rappresentare adeguatamente la regione di massima densit√† di probabilit√†. In tali casi, valori estremi possono influenzare eccessivamente la stima, allontanando la media dalla zona in cui √® concentrata la maggior parte della massa probabilistica. Per questo motivo, in situazioni di asimmetria pronunciata, altre statistiche come la *mediana* o la *moda* a posteriori possono offrire una rappresentazione pi√π appropriata della tendenza centrale.


### Mediana a posteriori {.unnumbered}

La *mediana a posteriori* √® definita come il valore del parametro $\theta$ che divide la distribuzione a posteriori in due parti di uguale probabilit√†: il 50% della massa probabilistica si trova al di sotto di tale valore e il restante 50% al di sopra. Formalmente, essa soddisfa la condizione:

$$
P(\theta \leq \hat{\theta}_{\text{med}} \mid y) = 0.5.
$$

Rispetto alla media e alla moda a posteriori, la mediana offre una misura di tendenza centrale particolarmente *robusta*, in quanto poco sensibile alla presenza di valori estremi o code distributive pesanti. Questa propriet√† la rende preferibile in contesti in cui la distribuzione a posteriori presenta marcate *asimmetrie* o √® *multimodale*, situazioni in cui la media pu√≤ essere distortta da valori anomali e la moda pu√≤ risultare instabile o non unica. Grazie alla sua stabilit√†, la mediana a posteriori fornisce una rappresentazione pi√π affidabile della posizione centrale del parametro quando la forma della distribuzione √® irregolare, garantendo una sintesi inferenziale solida anche in condizioni di elevata variabilit√† o non normalit√†.


## Misurare l'incertezza: varianza a posteriori {.unnumbered}

Oltre a individuare il valore pi√π plausibile del parametro $\theta$, √® fondamentale quantificare l'incertezza residua associata alla nostra stima. A questo scopo, la *varianza a posteriori* fornisce una misura della dispersione dei valori di $\theta$ attorno alla sua media, condizionatamente ai dati osservati $y$. Formalmente, essa √® definita come:

$$
\mathbb{V}(\theta \mid y) = \mathbb{E}\left[(\theta - \mathbb{E}[\theta \mid y])^2 \mid y \right] = \int (\theta - \mathbb{E}[\theta \mid y])^2 \, p(\theta \mid y) \, d\theta.
$$

Un modo equivalente per calcolarla √® attraverso l'identit√†:

$$
\mathbb{V}(\theta \mid y) = \mathbb{E}[\theta^2 \mid y] - \left(\mathbb{E}[\theta \mid y]\right)^2.
$$

Per interpretare pi√π facilmente l‚Äôincertezza nella stessa unit√† di misura del parametro $\theta$, √® utile considerare la *deviazione standard a posteriori*, data semplicemente dalla radice quadrata della varianza.

In conclusione, mentre la moda (MAP), la media e la mediana a posteriori forniscono diverse misure di tendenza centrale per la stima puntuale di $\theta$, la varianza (e la deviazione standard) a posteriori ne quantificano l'affidabilit√†. La scelta tra le diverse statistiche dipende dalla forma della distribuzione a posteriori e dagli obiettivi dell‚Äôanalisi. Nel loro insieme, questi indicatori consentono di comunicare in modo sintetico non solo la migliore stima del parametro, ma anche il grado di confidenza ad essa associato, elemento cruciale in qualsiasi processo inferenziale.


## Intervallo di credibilit√†

Nell'inferenza bayesiana, l'intervallo di credibilit√† √® uno strumento utilizzato per definire un intervallo che contiene una determinata percentuale della massa della distribuzione a posteriori del parametro $\theta$. Questo intervallo riflette l'incertezza associata alla stima del parametro: un intervallo pi√π ampio suggerisce una maggiore incertezza. Lo scopo principale dell'intervallo di credibilit√† √® fornire una misura quantitativa dell'incertezza riguardante $\theta$.

A differenza degli intervalli di confidenza frequentisti, non esiste un unico intervallo di credibilit√† per un dato livello di confidenza $(1 - \alpha) \cdot 100\%$. In effetti, √® possibile costruire un numero infinito di tali intervalli. Per questo motivo, √® necessario stabilire criteri aggiuntivi per selezionare l'intervallo di credibilit√† pi√π appropriato. Tra le opzioni pi√π comuni ci sono l'intervallo di credibilit√† simmetrico e l'intervallo di massima densit√† posteriore (HPD).


### Intervallo di credibilit√† simmetrico {.unnumbered}

Questo tipo di intervallo √® centrato rispetto al punto di stima puntuale. Se $\hat{\theta}$ rappresenta la stima del parametro, l'intervallo simmetrico avr√† la forma $(\hat{\theta} - a, \hat{\theta} + a)$, dove $a$ √® un valore positivo scelto in modo tale che la massa totale inclusa sia pari a $(1 - \alpha)$. Pi√π formalmente, un intervallo di credibilit√† simmetrico al livello $\alpha$ pu√≤ essere espresso come:

$$ 
I_{\alpha} = [q_{\alpha/2}, q_{1 - \alpha/2}], 
$$
dove $q_z$ rappresenta il quantile $z$ della distribuzione a posteriori. Ad esempio, un intervallo di credibilit√† simmetrico al 94% sar√†:

$$ 
I_{0.06} = [q_{0.03}, q_{0.97}], 
$$
dove il 3% della massa a posteriori si trova in ciascuna delle due code della distribuzione.


### Intervallo di credibilit√† pi√π stretto (intervallo di massima densit√† posteriore, HPD) {.unnumbered}

L'intervallo di massima densit√† posteriore (HPD) √® l'intervallo pi√π stretto possibile che contiene il $(1 - \alpha) \cdot 100\%$ della massa a posteriori. A differenza dell'intervallo simmetrico, l'HPD include tutti i valori di $\theta$ che hanno la maggiore densit√† a posteriori. Per costruirlo, si disegna una linea orizzontale sulla distribuzione a posteriori e si regola l'altezza della linea in modo che l'area sotto la curva corrisponda a $(1 - \alpha)$. L'HPD risulta essere il pi√π stretto tra tutti gli intervalli possibili per lo stesso livello di confidenza. Nel caso di una distribuzione a posteriori unimodale e simmetrica, l'HPD coincide con l'intervallo di credibilit√† simmetrico.


### Interpretazione

Il calcolo degli *intervalli di credibilit√†*‚Äîin particolare dell‚Äô*intervallo di massima densit√† posteriore* (HPD)‚Äîrichiede quasi sempre l‚Äôutilizzo di software statistici specializzati. Questo perch√©, nei modelli bayesiani con distribuzioni posteriori articolate o che richiedono simulazioni numeriche (ad esempio tramite Markov Chain Monte Carlo), ricavare a mano i confini dell‚Äôintervallo pu√≤ risultare molto laborioso.

#### Incertezza nel paradigma frequentista  

- *Parametro fisso*: nel contesto frequentista, il parametro di interesse (ad esempio la media di popolazione $\mu$) √® un valore costante ma sconosciuto.  
- *Ripetizione ipotetica*: immaginiamo di ripetere all‚Äôinfinito il prelievo di campioni dalla popolazione. Per ciascun campione otteniamo una media $\bar{x}$ e costruendo un intervallo di confidenza al $100(1-\alpha)\%$ avremo che, nel lungo periodo, il $100(1-\alpha)\%$ di questi intervalli conterr√† il vero $\mu$.  
- *Interpretazione del singolo intervallo*: per un singolo intervallo calcolato, la probabilit√† che contenga effettivamente $\mu$ √® formalmente 0 o 1, perch√© $\mu$ non √® soggetto a variabilit√† stocastica‚Äîsiamo semplicemente ignari del suo valore reale.

#### Incertezza nel paradigma bayesiano  

- *Parametro come variabile aleatoria*: qui $\mu$ non √® pi√π un valore fisso, ma possiede una distribuzione di probabilit√† che riflette sia l‚Äôinformazione a priori sia quella fornita dai dati osservati.  
- *Campionamento dalla distribuzione a posteriori*: grazie a tecniche di simulazione (ad es. MCMC), otteniamo un insieme di possibili valori di $\mu$ che segue la distribuzione posteriore.  
- *Costruzione diretta dell‚Äôintervallo*: scegliendo i quantili al $2.5\%$ e al $97.5\%$ di questa distribuzione, otteniamo un intervallo di credibilit√† al 95%. In termini intuitivi, possiamo affermare che ¬´c‚Äô√® una probabilit√† del 95% che $\mu$ cada all‚Äôinterno di questo intervallo, dati i dati e le ipotesi a priori¬ª.

#### Confronto e considerazioni  

- *Frequentista*: l‚Äôintervallo di confidenza √® un costrutto legato alla frequenza di lungo periodo di un procedimento ipotetico di campionamento.  
- *Bayesiano*: l‚Äôintervallo di credibilit√† fornisce una misura puntuale dell‚Äôincertezza sul parametro, direttamente comprensibile come probabilit√† condizionata sui dati osservati.  
- *Intuizione*: per molti, l‚Äôinterpretazione bayesiana risulta pi√π aderente al senso comune, perch√© traduce immediatamente il grado di fiducia che possiamo riporre nei valori ipotizzati per il parametro.

In sintesi, mentre la teoria frequentista quantifica l‚Äôaffidabilit√† del metodo di stima nel lungo periodo, l‚Äôapproccio bayesiano esprime senza ambiguit√† la probabilit√† attuale che il parametro si trovi in un certo intervallo, alla luce delle evidenze e delle conoscenze pregresse.


## Verifica di ipotesi bayesiana

L'inferenza bayesiana pu√≤ essere applicata anche nel contesto della verifica di ipotesi, in un approccio noto come *verifica di ipotesi bayesiana*. In questo tipo di inferenza, l'obiettivo √® valutare la plausibilit√† che un parametro $\theta$ assuma valori all'interno di un determinato intervallo. Ad esempio, possiamo voler sapere quanto √® probabile che $\theta$ sia maggiore di 0.5 o che rientri in un intervallo specifico, come [0.5, 1.0].

In questo approccio, si calcola la *probabilit√† a posteriori* che $\theta$ si trovi all'interno dell'intervallo di interesse. Questa probabilit√† viene ottenuta integrando la distribuzione a posteriori su tale intervallo. Quindi, invece di rifiutare o accettare un'ipotesi come nel test di ipotesi frequentista, la verifica di ipotesi bayesiana fornisce una misura diretta della probabilit√† che un parametro rientri in un intervallo specifico, dato l'evidenza osservata e le informazioni a priori.

In altre parole, questo approccio consente di quantificare la nostra incertezza rispetto all'affermazione che $\theta$ rientri in un certo intervallo, fornendo una probabilit√† che rappresenta direttamente la plausibilit√† di quell'ipotesi.

::: {#exm-}
Per illustrare l'approccio bayesiano, consideriamo i dati relativi ai punteggi del BDI-II (*Beck Depression Inventory - Second Edition*) di 30 soggetti clinici, come riportato nello studio condotto da @zetsche_2019future. Il BDI-II √® uno strumento per valutare la gravit√† dei sintomi depressivi.

I punteggi del BDI-II per i 30 soggetti sono:

```{r}
# Dati del BDI-II
bdi <- c(
  26, 35, 30, 25, 44, 30, 33, 43, 22, 43, 
  24, 19, 39, 31, 25, 28, 35, 30, 26, 31, 
  41, 36, 26, 35, 33, 28, 27, 34, 27, 22
)
bdi
```

Un punteggio BDI-II $\geq 30$ indica un livello grave di depressione. Nel nostro campione, 17 pazienti su 30 manifestano un livello grave:

```{r}
# Conteggio di depressione grave
sum(bdi >= 30)
```

Stima della distribuzione a posteriori.

Supponiamo di voler stimare la probabilit√† $\theta$ di depressione grave nei pazienti clinici utilizzando una distribuzione a priori $Beta(8, 2)$. I dati possono essere visti come una sequenza di prove Bernoulliane indipendenti, dove la presenza di depressione grave √® un "successo". La verosimiglianza √® quindi binomiale con parametri $n = 30$ e $y = 17$.

Con una distribuzione a priori $Beta(8, 2)$, la distribuzione a posteriori di $\theta$ sar√†:

$$
\text{Beta}(\alpha = 8 + 17, \beta = 2 + 30 - 17) = \text{Beta}(25, 15).
$$
Tracciamo la distribuzione a posteriori.

```{r}
# Parametri della distribuzione Beta
alpha <- 25
beta <- 15

# Calcolo della densit√† per valori di theta
theta <- seq(0, 1, length.out = 200)
posterior_density <- dbeta(theta, alpha, beta)

# Grafico della distribuzione a posteriori
ggplot(data = data.frame(theta, posterior_density), aes(x = theta, y = posterior_density)) +
  geom_line() +
  labs(
    title = "Distribuzione a Posteriori Beta(25, 15)",
    x = expression(theta),
    y = "Densit√† di probabilit√†"
  ) 
```

**Stime puntuali.**

1. **Media a posteriori.**  La media della distribuzione a posteriori √® calcolata come:

$$
\mathbb{E}(\theta | y = 17) = \frac{\alpha}{\alpha + \beta} = \frac{25}{25 + 15} = 0.625.
$$
In R:

```{r}
# Calcolo della media a posteriori
posterior_mean <- alpha / (alpha + beta)
posterior_mean
```

2. **Moda a posteriori (MAP).**  La moda della distribuzione a posteriori √®:

$$
Mo(\theta | y = 17) = \frac{\alpha - 1}{\alpha + \beta - 2} = \frac{25 - 1}{25 + 15 - 2} = 0.6316.
$$
In R:

```{r}
# Calcolo della moda a posteriori
posterior_mode <- (alpha - 1) / (alpha + beta - 2)
posterior_mode
```

3. **Mediana a posteriori.**  La mediana si ottiene utilizzando la funzione di distribuzione cumulativa inversa:

```{r}
# Calcolo della mediana a posteriori
posterior_median <- qbeta(0.5, alpha, beta)
posterior_median
```

**Intervallo di credibilit√†.**

1. **Intervallo di credibilit√† simmetrico.** L'intervallo di credibilit√† simmetrico al 94% √® dato dai percentili 3% e 97%:

```{r}
# Intervallo di credibilit√† simmetrico al 94%
cred_interval <- qbeta(c(0.03, 0.97), alpha, beta)
cred_interval
```

Possiamo interpretare questo intervallo come segue: c'√® una certezza soggettiva del 94% che $\theta$ sia compreso tra 0.478 e 0.761.

**Verifica di ipotesi bayesiana.** Infine, calcoliamo la probabilit√† che $\theta > 0.5$:

$$
P(\theta > 0.5 | y = 17) = \int_{0.5}^1 f(\theta | y = 17) d\theta.
$$
In R:

```{r}
# Probabilit√† P(theta > 0.5)
prob_theta_greater_0_5 <- pbeta(0.5, alpha, beta, lower.tail = FALSE)
prob_theta_greater_0_5
```

In conclusione, utilizzando un approccio bayesiano, abbiamo stimato la distribuzione a posteriori di $\theta$, ottenuto stime puntuali e costruito intervalli di credibilit√†. Abbiamo inoltre calcolato la probabilit√† che $\theta$ superi una soglia specifica, mostrando la flessibilit√† e l'interpretabilit√† delle analisi bayesiane.
:::


## Sintesi della distribuzione a posteriori in contesti multivariati

L'estensione dell'analisi bayesiana a modelli con pi√π parametri introduce complessit√† legate alle interdipendenze tra i parametri stessi. Tali relazioni, se non adeguatamente considerate, possono condurre a sintesi incomplete o fuorvianti della distribuzione a posteriori, con possibili errori interpretativi.

### La sfida delle correlazioni tra parametri

Uno degli aspetti critici riguarda la presenza di *correlazioni tra i parametri*. Le distribuzioni marginali a posteriori ‚Äî spesso utilizzate nei riassunti statistici ‚Äî possono risultare ingannevoli se esaminate isolatamente. Parametri fortemente correlati possono dar luogo a marginali apparentemente piatte o poco informative, bench√© la loro struttura congiunta restringa significativamente lo spazio delle combinazioni plausibili. Ci√≤ implica che, nonostante l'incertezza marginale possa sembrare elevata, l'incertezza congiunta su specifiche relazioni parametriche pu√≤ essere molto ridotta.

Un'ulteriore complicazione sorge quando le relazioni tra parametri sono *non lineari*. In tali casi, il massimo della distribuzione congiunta pu√≤ non coincidere con i massimi delle distribuzioni marginali. Ad esempio, in presenza di strutture a "banana" o altre forme complesse, gli usuali indicatori di tendenza centrale (come la moda o la media) calcolati sui singoli parametri possono non riflettere la regione di massima densit√† di probabilit√† nello spazio multivariato.


### Approcci per una sintesi efficace

Per una rappresentazione fedele dell‚Äôincertezza in contesti multivariati, √® essenziale adottare una prospettiva che vada oltre l‚Äôanalisi delle marginali:

- **Visualizzazione delle relazioni congiunte**: Grafici di dispersione a coppie (*pair plots*) o contour plot bidimensionali consentono di esplorare visivamente le dipendenze tra parametri, rivelando strutture non catturate dalle marginali.
  
- **Utilizzo di distribuzioni predittive**: Il confronto tra distribuzioni predittive a priori e a posteriori fornisce una visione complessiva dell‚Äôincertezza ridotta dall‚Äôevidenza dei dati, tenendo conto di tutte le interazioni parametriche.

- **Misure di dipendenza avanzate**: In casi di relazioni non lineari, misure come la correlazione di Spearman o l‚Äôinformazione mutua possono integrare la correlazione lineare, offrendo una descrizione pi√π completa delle dipendenze.

- **Analisi di sensibilit√†**: Valutare come variano le inferenze al variare di gruppi di parametri aiuta a identificare le relazioni pi√π influenti e a comprendere la stabilit√† delle conclusioni.

In conclusione, una sintesi appropriata della distribuzione a posteriori in presenza di pi√π parametri richiede un esame congiunto delle relazioni tra di essi. La sola inspezione delle distribuzioni marginali rischia di occultare importanti fonti di informazione circa la struttura parametrica, con possibili conseguenze sulle inferenze tratte. Un approccio integrato ‚Äî che unisca visualizzazione, misure di dipendenza e analisi di sensibilit√† ‚Äî √® fondamentale per una comprensione robusta dei risultati bayesiani in contesti multivariati.


## Riflessioni conclusive {.unnumbered .unlisted}

In questo capitolo abbiamo visto che il cuore dell‚Äôapproccio bayesiano non √® soltanto ottenere una distribuzione a posteriori, ma anche imparare a descriverla in modo utile. Abbiamo distinto tra diversi modi di riassumere un posterior (media, mediana, moda) e tra diverse forme di intervallo credibile, chiarendo come ciascuna offra una prospettiva diversa sull‚Äôincertezza.

Queste sintesi non sostituiscono la distribuzione completa, ma la rendono comunicabile. L‚Äôintervallo credibile, in particolare, ci permette di dire con chiarezza quali valori del parametro hanno una certa probabilit√† a posteriori di essere veri, dato il modello e i dati osservati. Questo rappresenta una differenza cruciale rispetto all‚Äôapproccio frequentista, in cui l‚Äôinterpretazione degli intervalli di confidenza rimane indiretta e spesso fonte di equivoci.

Dal punto di vista della ricerca psicologica, la capacit√† di sintetizzare il posterior √® indispensabile. Molti risultati sperimentali si basano sulla stima di proporzioni, medie o differenze tra gruppi, e il modo in cui presentiamo l‚Äôincertezza pu√≤ fare la differenza tra una conclusione chiara e una affermazione ambigua. Una sintesi ben costruita non solo comunica meglio, ma rafforza la solidit√† della conoscenza accumulata, perch√© rende trasparenti i margini di dubbio.

Questo capitolo chiude cos√¨ un primo ciclo del nostro percorso: abbiamo imparato a costruire distribuzioni a posteriori e a sintetizzarle. Nei prossimi capitoli vedremo come andare oltre i parametri e usare il posterior per *fare previsioni sui dati futuri* e per *confrontare modelli alternativi*. √à qui che il pensiero bayesiano mostrer√† tutta la sua forza: non solo descrivere ci√≤ che sappiamo, ma anche guidare ci√≤ che possiamo aspettarci.


::: {.callout-important title="Problemi" collapse="true"}
**1. Quali sono le principali statistiche utilizzate per la stima puntuale di un parametro nella distribuzione a posteriori?**

   - Spiega le differenze tra **moda (MAP)**, **media a posteriori** e **mediana**.
   - In quali contesti √® preferibile utilizzare una di queste statistiche rispetto alle altre?

**2. Qual √® la differenza tra un intervallo di credibilit√† bayesiano e un intervallo di confidenza frequentista?**

   - Spiega le differenze concettuali tra i due approcci.
   - Quale dei due √® pi√π intuitivo in termini di incertezza sui parametri?

**3. Cos‚Äô√® un intervallo di massima densit√† posteriore (HPD) e in cosa si differenzia dall‚Äôintervallo di credibilit√† simmetrico?**

   - Spiega il concetto di HPD e perch√© √® pi√π informativo in alcuni casi.
   - In quali situazioni l‚ÄôHPD √® preferibile rispetto all‚Äôintervallo di credibilit√† simmetrico?

**4. Quali sono le problematiche associate alla moda (MAP) come stima puntuale?**

   - Perch√© il **MAP** pu√≤ essere meno affidabile rispetto ad altre statistiche?
   - Quali problemi si possono incontrare nei modelli bayesiani complessi?

**5. In che modo la sintesi della distribuzione a posteriori cambia nel caso di pi√π parametri incogniti?**

   - Quali sono le principali difficolt√† nell‚Äôinterpretare la distribuzione congiunta di pi√π parametri?
   - Come si possono visualizzare e sintetizzare distribuzioni posteriori multivariate?

**Domande applicative in R**

Per queste domande, usa il dataset basato sulla **Satisfaction with Life Scale (SWLS)**, supponendo che i dati seguano una distribuzione normale.

**1. Calcola la media, la mediana e la moda a posteriori della distribuzione della media SWLS, assumendo una distribuzione a priori gaussiana molto diffusa.**
   - Usa il metodo delle distribuzioni coniugate per ottenere la distribuzione a posteriori.

**2. Costruisci un intervallo di credibilit√† simmetrico al 94% per la media SWLS.**

   - Usa la distribuzione normale a posteriori per calcolare l‚Äôintervallo.


**3. Visualizza la distribuzione a posteriori della media SWLS con un grafico di densit√†.**

   - Genera un campione dalla distribuzione a posteriori e rappresentalo con **ggplot2**.

**4. Confronta l‚Äôintervallo di credibilit√† simmetrico con l‚Äôintervallo di massima densit√† posteriore (HPD).**

   - Usa la funzione **hdi()** del pacchetto **bayestestR** per calcolare l‚ÄôHPD.


**5. Calcola la probabilit√† a posteriori che la media SWLS sia minore di 23.**

   - Usa la distribuzione a posteriori per calcolare questa probabilit√†.

:::

::: {.callout-tip title="Soluzioni" collapse="true"}
**1. Quali sono le principali statistiche utilizzate per la stima puntuale di un parametro nella distribuzione a posteriori?**


Le tre principali statistiche usate per ottenere una **stima puntuale** del parametro $\theta$ nella distribuzione a posteriori sono:

1. **Moda (Massimo a Posteriori, MAP)**  
   - √à il valore di $\theta$ che massimizza la distribuzione a posteriori $p(\theta \mid y)$.  
   - Se la distribuzione √® unimodale e simmetrica, il MAP coincide con la media a posteriori.  
   - Il MAP √® spesso simile alla stima di massima verosimiglianza (MLE) quando il prior √® uniforme.  

2. **Media a Posteriori**  
   - √à il valore atteso della distribuzione a posteriori:  
     $$
     E(\theta \mid y) = \int \theta \, p(\theta \mid y) \, d\theta
     $$
   - √à la stima pi√π utile quando si vuole minimizzare l'errore quadratico medio (MSE).  
   - Risente dell'eventuale asimmetria della distribuzione, spostandosi verso le code.

3. **Mediana a Posteriori**  
   - √à il valore che divide la distribuzione a posteriori in due parti uguali:  
     $$
     P(\theta \leq \theta_{\text{mediana}} \mid y) = 0.5
     $$
   - √à pi√π robusta agli outlier rispetto alla media ed √® utile quando la distribuzione √® fortemente asimmetrica.

üí° **Quando usarle?**
- Se la distribuzione √® **simmetrica**, tutte e tre le statistiche coincidono.
- Se la distribuzione √® **asimmetrica**, la **mediana** √® pi√π robusta, la **media** pu√≤ essere influenzata dalle code e il **MAP** √® utile se si vuole un valore pi√π probabile.

**2. Qual √® la differenza tra un intervallo di credibilit√† bayesiano e un intervallo di confidenza frequentista?**


| Caratteristica                 | Intervallo di Credibilit√† (Bayesiano) | Intervallo di Confidenza (Frequentista) |
|--------------------------------|--------------------------------------|----------------------------------------|
| **Significato** | Esprime la probabilit√† che il parametro sia nell'intervallo, dati i dati osservati. | √à una propriet√† di un metodo di campionamento: se si ripetesse l‚Äôesperimento infinite volte, il $(1 - \alpha)100\%$ degli intervalli conterrebbe il vero valore del parametro. |
| **Approccio** | Assume che il parametro sia una variabile casuale con una distribuzione di probabilit√†. | Assume che il parametro sia fisso e sconosciuto, mentre i dati sono casuali. |
| **Interpretazione** | "C'√® il 95% di probabilit√† che il parametro sia tra questi valori." | "Se ripetessimo l'esperimento molte volte, il 95% degli intervalli conterrebbe il vero parametro." |

üí° **Differenza fondamentale:**  

- L'intervallo di credibilit√† √® **probabilistico** e pi√π intuitivo: si pu√≤ direttamente dire che il parametro ha il 95% di probabilit√† di trovarsi nell'intervallo.  
- L'intervallo di confidenza √® **basato sulla ripetizione ipotetica** dell'esperimento e non pu√≤ essere interpretato in termini probabilistici sul singolo intervallo.

**3. Cos‚Äô√® un intervallo di massima densit√† posteriore (HPD) e in cosa si differenzia dall‚Äôintervallo di credibilit√† simmetrico?**
 
L‚Äô**intervallo di massima densit√† posteriore (HPD)** √® l‚Äôintervallo pi√π stretto che contiene una percentuale fissata (es. 94%) della distribuzione a posteriori. Si distingue dall'intervallo di credibilit√† simmetrico perch√©:

| Caratteristica | Intervallo HPD | Intervallo di Credibilit√† Simmetrico |
|--------------|-------------|--------------------------------|
| **Definizione** | Contiene il  $(1 - \alpha)100\%$ della probabilit√† a posteriori, minimizzando la lunghezza dell‚Äôintervallo. | √à centrato attorno alla mediana e copre una frazione fissa della distribuzione. |
| **Forma** | Pu√≤ essere asimmetrico e discontinuo se la distribuzione √® multimodale. | √à sempre simmetrico. |
| **Vantaggio** | √à pi√π informativo se la distribuzione √® asimmetrica o multimodale. | √à pi√π facile da calcolare, specialmente per distribuzioni unimodali. |

üí° **Quando usarli?**  

- Se la distribuzione √® **simmetrica**, entrambi gli intervalli danno risultati simili.  
- Se la distribuzione √® **asimmetrica o multimodale**, l‚ÄôHPD √® pi√π informativo.

**4. Quali sono le problematiche associate alla moda (MAP) come stima puntuale?**
 
Sebbene il **MAP** sia un concetto intuitivo (il valore pi√π probabile della distribuzione a posteriori), presenta alcune limitazioni:

1. **Difficolt√† computazionale con MCMC**  
   - Con metodi di campionamento come **Markov Chain Monte Carlo (MCMC)**, trovare il massimo della distribuzione a posteriori √® difficile perch√© la funzione viene stimata in modo discreto.
   - Spesso si preferisce stimare **media** o **mediana**, pi√π facili da calcolare con MCMC.

2. **Sensibilit√† ai dati e al prior**  
   - Il MAP dipende fortemente dal **prior** scelto.
   - Se il prior √® informativo, il MAP pu√≤ spostarsi troppo rispetto ai dati.

3. **Problemi con distribuzioni multimodali**  
   - Se la distribuzione a posteriori ha pi√π di un massimo (moda), il MAP potrebbe non essere una buona rappresentazione della distribuzione.

üí° **Quando evitarlo?**  
- Se la distribuzione a posteriori √® **asimmetrica o multimodale**.
- Se si usa un **metodo MCMC**, dove la media o la mediana sono pi√π semplici da stimare.

**5. In che modo la sintesi della distribuzione a posteriori cambia nel caso di pi√π parametri incogniti?**
 
Quando l'inferenza bayesiana coinvolge pi√π parametri (es. $\mu$ e $\sigma$), l'analisi diventa pi√π complessa per diversi motivi:

1. **Interazioni tra parametri**  
   - I parametri spesso non sono indipendenti: la distribuzione a posteriori congiunta pu√≤ mostrare **correlazioni** che non emergono dalle distribuzioni marginali.

2. **Difficolt√† di visualizzazione**  
   - Per un parametro si usa un istogramma o una funzione di densit√†.
   - Per due parametri si usa un **contour plot** o un **grafico 3D**.
   - Con pi√π di due parametri, si ricorre a **pair plots** o **matrici di correlazione**.

3. **Stimare margine e congiunta**  
   - La distribuzione marginale di un parametro si ottiene integrando la distribuzione congiunta rispetto agli altri parametri:
     $$
     p(\theta_1) = \int p(\theta_1, \theta_2) d\theta_2
     $$
   - Se i parametri sono fortemente correlati, le marginali possono **nascondere informazioni importanti**.

4. **Rischio di correlazioni non lineari**  
   - Le correlazioni non lineari tra i parametri possono portare a distribuzioni con forme complesse (es. a banana), rendendo difficile la sintesi con MAP o media.

üí° **Strategie per affrontare il problema:**  
- **Visualizzare le correlazioni** tra i parametri con scatter plot o heatmap.  
- **Usare tecniche di riduzione della dimensionalit√†** come PCA (Analisi delle Componenti Principali).  
- **Utilizzare il MCMC** per campionare direttamente dalla distribuzione congiunta.

**Esercizio in R con i dati SWLS**

Nell'esercizio, usa i dati della SWLS che sono stati raccolti. Qui useremo i dati seguenti:

```r
swls_data <- data.frame(
  soddisfazione = c(4.2, 5.1, 4.7, 4.3, 5.5, 4.9, 4.8, 5.0, 4.6, 4.4)
)
```

**1. Calcola la media, la mediana e la moda a posteriori della distribuzione della media SWLS, assumendo una distribuzione a priori gaussiana molto diffusa.**

   - Usa il metodo delle distribuzioni coniugate per ottenere la distribuzione a posteriori.

```r
library(tibble)

# Dati
n <- nrow(swls_data)
mean_x <- mean(swls_data$soddisfazione)
sigma <- 1  # Deviazione standard nota

# Prior diffuso
mu_prior <- 4.5    
sigma_prior <- 10  

# Media a posteriori
mu_post <- (sigma_prior^2 * mean_x + sigma^2 * n * mu_prior) / (sigma_prior^2 + sigma^2 * n)

# Deviazione standard a posteriori
sigma_post <- sqrt((sigma_prior^2 * sigma^2) / (sigma_prior^2 + sigma^2 * n))

# Moda (MAP)
posterior_mode <- mu_post  # Per una distribuzione normale, MAP coincide con la media

# Mediana (simile alla media in una distribuzione normale)
posterior_median <- mu_post

tibble("Media a Posteriori" = mu_post,
       "Moda (MAP)" = posterior_mode,
       "Mediana" = posterior_median)
```

**2. Costruisci un intervallo di credibilit√† simmetrico al 94% per la media SWLS.**

   - Usa la distribuzione normale a posteriori per calcolare l‚Äôintervallo.

```r
cred_interval <- qnorm(c(0.03, 0.97), mean = mu_post, sd = sigma_post)
cred_interval
```

**3. Visualizza la distribuzione a posteriori della media SWLS con un grafico di densit√†.**

   - Genera un campione dalla distribuzione a posteriori e rappresentalo con **ggplot2**.

```r
library(ggplot2)

# Campionamento dalla distribuzione a posteriori
set.seed(123)
samples <- rnorm(1000, mean = mu_post, sd = sigma_post)

# Creazione del dataframe
samples_df <- tibble(media_campionata = samples)

# Grafico della distribuzione a posteriori
ggplot(samples_df, aes(x = media_campionata)) +
  geom_density(fill = "blue", alpha = 0.5) +
  labs(title = "Distribuzione a Posteriori della Media SWLS",
       x = "Media", y = "Densit√†")
```

**4. Confronta l‚Äôintervallo di credibilit√† simmetrico con l‚Äôintervallo di massima densit√† posteriore (HPD).**

   - Usa la funzione **hdi()** del pacchetto **bayestestR** per calcolare l‚ÄôHPD.

```r
library(bayestestR)

# Calcolo intervallo HPD al 94%
hpd_interval <- hdi(samples, ci = 0.94)
hpd_interval
```

**5. Calcola la probabilit√† a posteriori che la media SWLS sia minore di 23 -- per fare un esempio, qui caloleremo per i dati simulati la probabilit√† a posteriori per la media SWLS maggiore di 4.7.**

   - Usa la distribuzione a posteriori per calcolare questa probabilit√†.

```r
prob_greater_4_7 <- 1 - pnorm(4.7, mean = mu_post, sd = sigma_post)
prob_greater_4_7
```
:::


::: {.callout-note collapse=true title="Informazioni sull'ambiente di sviluppo"}
```{r}
sessionInfo()
```
:::

## Bibliografia {.unnumbered .unlisted}


